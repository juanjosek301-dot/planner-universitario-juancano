<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UPlanner - Estudiante</title>
  <link rel="stylesheet" href="../css/vista_estudiante.css"/>

  <!-- ‚úÖ Cargar CSS correctamente desde Flask -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/vista_estudiante.css') }}" />

  <!-- ‚úÖ FullCalendar desde CDN -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
</head>

<body>
  <!-- üîπ Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <!-- ‚úÖ Imagen servida desde carpeta static -->
      <img src="{{ url_for('static', filename='public/images/Uplannner.png') }}" alt="UPlanner Logo" />
    </div>
    <nav>
      <ul>
        <img src="{{ url_for('public_files', filename='images/Uplannner.png') }}" alt="UPlanner Logo" />
        <img src="{{ url_for('public_files', filename='images/perfil.png') }}" alt="Perfil" />
        <img src="{{ url_for('public_files', filename='images/tarea..png') }}" alt="Tareas" />
        <img src="{{ url_for('public_files', filename='images/logo_chat.png') }}" alt="Mensajes" />
      </ul>
    </nav>
  </aside>

  <!-- üî∏ Contenido principal -->
  <main class="main-content">
    <header class="main-header">
      <h1 id="bienvenida">Bienvenido, [Nombre]</h1>
    </header>

    <!-- üß© Cursos -->
    <section class="cursos-disponibles">
      <h2>üìö Cursos Disponibles</h2>
      <ul id="lista-cursos"></ul>
    </section>

    <!-- üìå Actividades -->
    <section class="actividades-section">
      <h2>Actividades del curso</h2>
      <button id="btn-agregar-actividad" style="margin-bottom:10px;">Agregar actividad</button>
      <ul id="lista-actividades"></ul>
    </section>

    <!-- ‚ö†Ô∏è Alertas -->
    <section class="alertas-section">
      <h2>Alertas acad√©micas</h2>
      <button id="btn-ver-alertas" style="margin-bottom:10px;">Ver alertas</button>
      <div id="alertas-list"></div>
    </section>

    <!-- ü§ñ Recomendaciones -->
    <section class="recomendaciones-section">
      <h2>Recomendaciones inteligentes</h2>
      <button id="btn-ver-recomendaciones" style="margin-bottom:10px;">Ver recomendaciones</button>
      <div id="recomendaciones-list"></div>
    </section>

    <!-- üìÖ Calendario -->
    <section class="calendario-section">
      <h2>Calendario acad√©mico</h2>
      <button id="btn-ver-calendario" style="margin-bottom:10px;">Ver calendario</button>
      <div id="calendario-widget"></div>
    </section>
  </main>

<script>

  document.addEventListener("DOMContentLoaded", async () => {
    const id_estudiante = localStorage.getItem("id_estudiante");

    if (!id_estudiante) {
      alert("‚ö†Ô∏è No se encontr√≥ el ID del estudiante. Inicia sesi√≥n nuevamente.");
      window.location.href = "/";
      return;
    }

    // üîπ Cargar cursos disponibles
    const res = await fetch("/api/cursos_disponibles");
    const cursos = await res.json();

    const lista = document.getElementById("lista-cursos");
    lista.innerHTML = "";

    cursos.forEach(curso => {
      const li = document.createElement("li");
      li.innerHTML = `
      <h3>${curso.nombre} (${curso.codigo})</h3>
      <p>${curso.descripcion}</p>
      <p><strong>Profesor:</strong> ${curso.profesor}</p>
      <button class="btn-inscribirse" data-id="${curso.id}">Inscribirme</button>
    `;
    lista.appendChild(li);
  });

  // üîπ Evento de inscripci√≥n
  lista.addEventListener("click", async (e) => {
    if (e.target.classList.contains("btn-inscribirse")) {
      const id_curso = e.target.getAttribute("data-id");
      
      try {
          const res = await fetch("/api/inscripciones", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id_estudiante, id_curso })
          });

      const data = await res.json();

      if (res.ok) {

        alert(data.mensaje || "‚úÖ Inscripci√≥n realizada con √©xito.");
      
        e.target.textContent = "Ya inscrito";
        e.target.disabled = true;
        e.target.style.backgroundColor = "#ccc";
      } else {
        alert("‚ö†Ô∏è " + (data.error || "Error al inscribirse."));
      }
      } catch (error) {
          console.error("üö® Error en la inscripci√≥n:", error);
          alert("Error de conexi√≥n con el servidor.");
      }
    }
  });
});
</script>

  
    
  

</body>
</html>
