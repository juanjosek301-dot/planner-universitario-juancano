<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UPlanner - Estudiante</title>
  <link rel="stylesheet" href="../css/vista_estudiante.css"/>

  <!-- ‚úÖ Cargar CSS correctamente desde Flask -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/vista_estudiante.css') }}" />

  <!-- ‚úÖ FullCalendar desde CDN -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
</head>

<body>
  <aside class="sidebar">
  <!-- Logo principal -->
  <div class="logo">
    <img src="{{ url_for('static', filename='public/images/Uplannner.png') }}" alt="UPlanner Logo" id="btn-logo"/>
  </div>

  <!-- Navegaci√≥n funcional -->
  <nav>
    <ul>
      <li><img src="{{ url_for('public_files', filename='images/perfil.png') }}" alt="Perfil" id="btn-perfil"/></li>
      <li><img src="{{ url_for('public_files', filename='images/logo_chat.png') }}" alt="Mensajes" id="btn-mensajes"/></li>
    </ul>
  </nav>
</aside>

  <!-- üî∏ Contenido principal -->
  <main class="main-content">
    <header class="main-header">
      <h1 id="bienvenida">Bienvenido, [Nombre]</h1>
    </header>

    <!-- üß© Cursos -->
    <section class="cursos-disponibles">
      <h2>üìö Cursos Disponibles</h2>
      <ul id="lista-cursos"></ul>
    </section>

    <section id="montar-tarea">
      <h2>Montar tarea</h2>

      <form id="form-entrega">
        <label>Seleccionar actividad:</label>
        <select id="select-actividad" required>
          <option value="">Selecciona una actividad</option>
        </select>

        <label>Archivo:</label>
        <input type="file" id="archivo_input" required>

        <button type="submit">Enviar Entrega</button>
        </form>
    </section>

    <!-- Mostrar contenido de la entrega -->
    <section class="contenido-entrega-section">
      <h2>Contenido de la entrega</h2>
      <select id="select-entrega">
        <option value="">Selecciona una entrega</option>
      </select>
      <button id="btn-ver-contenido">Ver contenido</button>
      <pre id="contenido-entrega" style="background:#f4f4f4; padding:10px; border:1px solid #ccc;"></pre>
    </section>

    <!-- ‚ö†Ô∏è Alertas -->
    <section class="alertas-section">
      <h2>Alertas acad√©micas</h2>
      <button id="btn-ver-alertas" style="margin-bottom:10px;">Ver alertas</button>
      <div id="alertas-list"></div>
    </section>

    <!-- ü§ñ Recomendaciones -->
    <section class="recomendaciones-section">
      <h2>Recomendaciones inteligentes</h2>
      <button id="btn-ver-recomendaciones" style="margin-bottom:10px;">Ver recomendaciones</button>
      <div id="recomendaciones-list"></div>
    </section>

    <!-- üìÖ Calendario -->
    <section class="calendario-section">
      <h2>Calendario acad√©mico</h2>
      <button id="btn-ver-calendario" style="margin-bottom:10px;">Ver calendario</button>
      <div id="calendario-widget"></div>
    </section>
  </main>

<script>

  document.addEventListener("DOMContentLoaded", async () => {
    const id_estudiante = localStorage.getItem("id_estudiante");

    if (!id_estudiante) {
      alert("‚ö†Ô∏è No se encontr√≥ el ID del estudiante. Inicia sesi√≥n nuevamente.");
      window.location.href = "/";
      return;
    }

    // üîπ Cargar cursos disponibles
    const res = await fetch("/api/cursos_disponibles");
    const cursos = await res.json();

    const lista = document.getElementById("lista-cursos");
    lista.innerHTML = "";

    cursos.forEach(curso => {
      const li = document.createElement("li");
      li.innerHTML = `
      <h3>${curso.nombre} (${curso.codigo})</h3>
      <p>${curso.descripcion}</p>
      <p><strong>Profesor:</strong> ${curso.profesor}</p>
      <button class="btn-inscribirse" data-id="${curso.id}">Inscribirme</button>
    `;
    lista.appendChild(li);
  });

  // üîπ Evento de inscripci√≥n
  lista.addEventListener("click", async (e) => {
    if (e.target.classList.contains("btn-inscribirse")) {
      const id_curso = e.target.getAttribute("data-id");
      
      try {
          const res = await fetch("/api/inscripciones", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id_estudiante, id_curso })
          });

      const data = await res.json();

      if (res.ok) {

        alert(data.mensaje || "‚úÖ Inscripci√≥n realizada con √©xito.");
      
        e.target.textContent = "Ya inscrito";
        e.target.disabled = true;
        e.target.style.backgroundColor = "#ccc";
      } else {
        alert("‚ö†Ô∏è " + (data.error || "Error al inscribirse."));
      }
      } catch (error) {
          console.error("üö® Error en la inscripci√≥n:", error);
          alert("Error de conexi√≥n con el servidor.");
      }
    }
  });
});
</script>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const id_estudiante = localStorage.getItem("id_estudiante");
    const selectActividad = document.getElementById("select-actividad");
    const formEntrega = document.getElementById("form-entrega");
    const archivoInput = document.getElementById("archivo_input");

    if (!id_estudiante) {
      alert("‚ö†Ô∏è No se encontr√≥ el ID del estudiante. Inicia sesi√≥n nuevamente.");
      window.location.href = "/";
      return;
    }

    // üîπ Cargar actividades disponibles para el estudiante
    async function cargarActividades() {
      try {
        const res = await fetch(`/api/actividades_estudiante/${id_estudiante}`);
        const actividades = await res.json();

        if (!res.ok) {
          console.error("üö® Error del servidor:", actividades.error);
          alert("Error al obtener actividades: " + actividades.error);
          return;
        }

        selectActividad.innerHTML = '<option value="">Selecciona una actividad</option>';

        actividades.forEach(act => {
          const option = document.createElement("option");
          option.value = act.id;
          option.textContent = `${act.titulo} (Entrega: ${act.fecha_entrega})`;
          selectActividad.appendChild(option);
        });

        console.log("üîπ Actividades cargadas:", actividades);

      } catch (error) {
        console.error("üö® Error al cargar actividades:", error);
        alert("Error al obtener las actividades: " + error.message);
      }
  }

  cargarActividades();

    // üîπ Evento submit para enviar entrega
    formEntrega.addEventListener("submit", async (e) => {
      e.preventDefault();

      const id_actividad = selectActividad.value;

      if (!id_actividad) {
        alert("Selecciona una actividad primero.");
        return;
      }

      if (archivoInput.files.length === 0) {
        alert("Selecciona un archivo para subir.");
        return;
      }

      const formData = new FormData();
      formData.append("id_estudiante", id_estudiante);
      formData.append("id_actividad", id_actividad);
      formData.append("archivo", archivoInput.files[0]);

      try {
        const res = await fetch("/api/entregas", {
          method: "POST",
          body: formData
      });

      const data = await res.json();

      if (res.ok) {
        alert(data.mensaje || "‚úÖ Entrega realizada correctamente.");
        formEntrega.reset();
      } else {
        alert("‚ö†Ô∏è " + (data.error || "Error al enviar la entrega."));
      }

      console.log("üîπ Respuesta del servidor:", data);

      } catch (error) {
        console.error("üö® Error al enviar entrega:", error);
        alert("üö® Error de conexi√≥n con el servidor: " + error.message);
      }
    });
});
</script>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const id_estudiante = localStorage.getItem("id_estudiante");
    const selectEntrega = document.getElementById("select-entrega");
    const btnVer = document.getElementById("btn-ver-contenido");
    const contenidoBox = document.getElementById("contenido-entrega");

    if (!id_estudiante) {
      alert("‚ö†Ô∏è No se encontr√≥ el ID del estudiante. Inicia sesi√≥n nuevamente.");
      window.location.href = "/";
      return;
    }

    // üîπ Cargar todas las entregas del estudiante
    async function cargarEntregas() {
      try {
        const res = await fetch(`/api/entregas_estudiante/${id_estudiante}`);
        const entregas = await res.json();

        selectEntrega.innerHTML = '<option value="">Selecciona una entrega</option>';

        entregas.forEach(e => {
          const option = document.createElement("option");
          option.value = e.id;
          option.textContent = `Actividad: ${e.id_actividad} - Estado: ${e.estado}`;
          selectEntrega.appendChild(option);
        });
      } catch (error) {
        console.error("üö® Error al cargar entregas:", error);
        alert("Error al obtener las entregas.");
      }
    }

    // Llamar la funci√≥n al cargar la p√°gina
    cargarEntregas();

    // üîπ Evento click para ver contenido de la entrega seleccionada
    btnVer.addEventListener("click", async () => {
      const id_entrega = selectEntrega.value;
      if (!id_entrega) {
        alert("Selecciona una entrega primero.");
        return;
      }

      try {
        const res = await fetch(`/api/entrega_contenido/${id_entrega}`);
        const data = await res.json();

        if (data.error) {
          contenidoBox.textContent = "‚ùå " + data.error;
        } else {
          contenidoBox.textContent = data.contenido;
        }

      } catch (error) {
        console.error("üö® Error al obtener contenido:", error);
        contenidoBox.textContent = "Error de conexi√≥n con el servidor.";
      }
    });
});
</script>



  
  


  
    
  

</body>
</html>
