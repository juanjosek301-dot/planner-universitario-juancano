<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UPlanner - Estudiante</title>
  <link rel="stylesheet" href="../css/vista_estudiante.css"/>

  <!-- ‚úÖ Cargar CSS correctamente desde Flask -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/vista_estudiante.css') }}" />

  <!-- ‚úÖ FullCalendar desde CDN -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
</head>

<body>
  <!-- üîπ Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <!-- ‚úÖ Imagen servida desde carpeta static -->
      <img src="{{ url_for('static', filename='public/images/Uplannner.png') }}" alt="UPlanner Logo" />
    </div>
    <nav>
      <ul>
        <img src="{{ url_for('public_files', filename='images/Uplannner.png') }}" alt="UPlanner Logo" />
        <img src="{{ url_for('public_files', filename='images/perfil.png') }}" alt="Perfil" />
        <img src="{{ url_for('public_files', filename='images/tarea..png') }}" alt="Tareas" />
        <img src="{{ url_for('public_files', filename='images/logo_chat.png') }}" alt="Mensajes" />
      </ul>
    </nav>
  </aside>

  <!-- üî∏ Contenido principal -->
  <main class="main-content">
    <header class="main-header">
      <h1 id="bienvenida">Bienvenido, [Nombre]</h1>
    </header>

    <!-- üß© Cursos -->
    <!-- üìò Inscripci√≥n a cursos -->
    <section class="inscripcion-section">
      <h2>üìò Inscribirse en un curso</h2>
      <p>Selecciona un curso disponible y haz clic en ‚ÄúInscribirse‚Äù.</p>
      <ul id="lista-cursos-disponibles"></ul>
    </section>

    <!-- üìå Actividades -->
    <section class="actividades-section">
      <h2>Actividades del curso</h2>
      <button id="btn-agregar-actividad" style="margin-bottom:10px;">Agregar actividad</button>
      <ul id="lista-actividades"></ul>
    </section>

    <!-- ‚ö†Ô∏è Alertas -->
    <section class="alertas-section">
      <h2>Alertas acad√©micas</h2>
      <button id="btn-ver-alertas" style="margin-bottom:10px;">Ver alertas</button>
      <div id="alertas-list"></div>
    </section>

    <!-- ü§ñ Recomendaciones -->
    <section class="recomendaciones-section">
      <h2>Recomendaciones inteligentes</h2>
      <button id="btn-ver-recomendaciones" style="margin-bottom:10px;">Ver recomendaciones</button>
      <div id="recomendaciones-list"></div>
    </section>

    <!-- üìÖ Calendario -->
    <section class="calendario-section">
      <h2>Calendario acad√©mico</h2>
      <button id="btn-ver-calendario" style="margin-bottom:10px;">Ver calendario</button>
      <div id="calendario-widget"></div>
    </section>
  </main>
  <!-- ‚úÖ Script JS -->
  <script>
    // üß† ID del estudiante (temporal)
    const idEstudiante = 3;

    // üîπ Cargar cursos disponibles
    async function cargarCursosDisponibles() {
      try {
        const res = await fetch('/api/cursos/');
        const data = await res.json();

        const lista = document.getElementById('lista-cursos-disponibles');
        lista.innerHTML = '';

        if (!data.length) {
          lista.innerHTML = '<li>No hay cursos disponibles por ahora.</li>';
          return;
        }

        data.forEach(curso => {
          const li = document.createElement('li');
          li.innerHTML = `
            <strong>${curso.nombre}</strong> (${curso.codigo})<br>
            <em>${curso.descripcion || 'Sin descripci√≥n'}</em><br>
            <button class="btn-inscribirse" data-id="${curso.id}">Inscribirse</button>
          `;
          lista.appendChild(li);
        });

        // Botones de inscripci√≥n
        document.querySelectorAll('.btn-inscribirse').forEach(btn => {
          btn.addEventListener('click', async () => {
            const idCurso = btn.dataset.id;
            await inscribirseEnCurso(idCurso);
          });
        });
      } catch (err) {
        console.error('Error al cargar cursos:', err);
      }
    }

    // üî∏ Funci√≥n para inscribirse
    async function inscribirseEnCurso(idCurso) {
      try {
        const res = await fetch('/api/inscripciones/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ id_curso: idCurso, id_estudiante: idEstudiante })
        });

        const data = await res.json();

        if (res.ok) {
          alert('‚úÖ Te has inscrito correctamente');
          cargarMisCursos();
        } else {
          alert('‚ùå ' + (data.error || 'Error al inscribirse'));
        }
      } catch (err) {
        console.error('Error al inscribirse:', err);
      }
    }

    // üîπ Cargar mis cursos
    async function cargarMisCursos() {
      try {
        const res = await fetch(`/api/inscripciones/estudiante/${idEstudiante}`);
        const data = await res.json();

        const lista = document.getElementById('lista-mis-cursos');
        lista.innerHTML = '';

        if (!data.length) {
          lista.innerHTML = '<li>No est√°s inscrito en ning√∫n curso.</li>';
          return;
        }

        data.forEach(curso => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>${curso.nombre}</strong> (${curso.codigo})<br>${curso.descripcion || ''}`;
          lista.appendChild(li);
        });
      } catch (err) {
        console.error('Error al cargar mis cursos:', err);
      }
    }

    // üî∏ Inicializaci√≥n
    cargarCursosDisponibles();
    cargarMisCursos();
  </script>

</body>
</html>
